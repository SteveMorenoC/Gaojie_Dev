<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - GAOJIE</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
    <!-- Announcement Bar -->
    <div class="announcement-bar">
        <div class="announcement-content">
            <span class="announcement-text">Admin Panel - GAOJIE Skincare Management</span>
        </div>
    </div>

    <!-- Main Header -->
    <header class="header">
        <div class="header-container">
            <!-- Logo -->
            <div class="logo">
                <a href="/" class="logo-link">GAOJIE</a>
            </div>

            <!-- Mobile Menu Toggle -->
            <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-label="Toggle menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>

            <!-- Admin Navigation -->
            <nav class="nav" id="main-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="/admin-dashboard" class="nav-link active">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin-orders" class="nav-link">Orders</a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin-products" class="nav-link">Products</a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin-analytics" class="nav-link">Analytics</a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin-influencer-applications" class="nav-link">Influencer Apps</a>
                    </li>
                </ul>
            </nav>

            <!-- Header Actions -->
            <div class="header-actions">
                <a href="/main" class="admin-view-site">View Site</a>
                
                <!-- Admin User Menu -->
                <div class="user-menu" id="admin-user-menu">
                    <button class="user-btn" aria-label="Admin menu">
                        <span class="user-name">Loading...</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                    <div class="user-dropdown" style="display: none;">
                        <a href="/main" class="dropdown-item">Main Site</a>
                        <a href="#" class="dropdown-item" onclick="handleLogout()">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Dashboard Content -->
    <main class="admin-main">
        <div class="admin-container">
            <!-- Dashboard Header -->
            <div class="admin-dashboard-header">
                <h1 class="admin-page-title">Dashboard</h1>
                <div class="admin-date-info">
                    <span class="admin-current-date">Today: July 28, 2025</span>
                </div>
            </div>

            <!-- Key Metrics Cards -->
            <div class="admin-metrics-grid">
                <div class="admin-metric-card">
                    <div class="admin-metric-icon sales">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2V22M17 5H9.5C8.11543 5 7 6.11543 7 7.5S8.11543 10 9.5 10H14.5C15.8846 10 17 11.1154 17 12.5S15.8846 15 14.5 15H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="admin-metric-content">
                        <h3 class="admin-metric-title">Today's Sales</h3>
                        <p class="admin-metric-value">฿24,890</p>
                        <span class="admin-metric-change positive">+12.5%</span>
                    </div>
                </div>

                <div class="admin-metric-card">
                    <div class="admin-metric-icon orders">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M16 4H18C19.1046 4 20 4.89543 20 6V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V6C4 4.89543 4.89543 4 6 4H8M16 4V2H8V4M16 4H8M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="admin-metric-content">
                        <h3 class="admin-metric-title">New Orders</h3>
                        <p class="admin-metric-value">43</p>
                        <span class="admin-metric-change positive">+8 today</span>
                    </div>
                </div>

                <div class="admin-metric-card">
                    <div class="admin-metric-icon customers">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="admin-metric-content">
                        <h3 class="admin-metric-title">New Customers</h3>
                        <p class="admin-metric-value">17</p>
                        <span class="admin-metric-change positive">+3 today</span>
                    </div>
                </div>

                <div class="admin-metric-card">
                    <div class="admin-metric-icon inventory">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M21 8C21 6.89543 20.1046 6 19 6H5C3.89543 6 3 6.89543 3 8V18C3 19.1046 3.89543 20 5 20H19C20.1046 20 21 19.1046 21 18V8Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M3 8L12 13L21 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 13V4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="admin-metric-content">
                        <h3 class="admin-metric-title">Low Stock Items</h3>
                        <p class="admin-metric-value">5</p>
                        <span class="admin-metric-change warning">Need attention</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions & Recent Activity -->
            <div class="admin-dashboard-grid">
                <!-- Quick Actions -->
                <div class="admin-dashboard-card">
                    <h2 class="admin-card-title">Quick Actions</h2>
                    <div class="admin-quick-actions">
                        <a href="/admin-products?action=add" class="admin-action-btn primary">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Add New Product
                        </a>
                        <a href="/admin-orders?status=pending" class="admin-action-btn secondary">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Process Orders
                        </a>
                        <a href="/admin-products?filter=low-stock" class="admin-action-btn warning">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 6V10M10 14H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Check Low Stock
                        </a>
                        <a href="/admin-analytics" class="admin-action-btn secondary">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M9 17V7M13 17V11M17 17V5M21 21H3L3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            View Reports
                        </a>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="admin-dashboard-card">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">Recent Orders</h2>
                        <a href="/admin-orders" class="admin-view-all">View All</a>
                    </div>
                    <div class="admin-recent-orders">
                        <div class="admin-order-item">
                            <div class="admin-order-info">
                                <span class="admin-order-id">#ORD240728001</span>
                                <span class="admin-order-customer">Siriporn T.</span>
                            </div>
                            <div class="admin-order-details">
                                <span class="admin-order-amount">฿1,290</span>
                                <span class="admin-order-status processing">Processing</span>
                            </div>
                        </div>

                        <div class="admin-order-item">
                            <div class="admin-order-info">
                                <span class="admin-order-id">#ORD240728002</span>
                                <span class="admin-order-customer">Apinya L.</span>
                            </div>
                            <div class="admin-order-details">
                                <span class="admin-order-amount">฿2,180</span>
                                <span class="admin-order-status pending">Payment Pending</span>
                            </div>
                        </div>

                        <div class="admin-order-item">
                            <div class="admin-order-info">
                                <span class="admin-order-id">#ORD240728003</span>
                                <span class="admin-order-customer">Kamon P.</span>
                            </div>
                            <div class="admin-order-details">
                                <span class="admin-order-amount">฿3,590</span>
                                <span class="admin-order-status shipped">Shipped</span>
                            </div>
                        </div>

                        <div class="admin-order-item">
                            <div class="admin-order-info">
                                <span class="admin-order-id">#ORD240727004</span>
                                <span class="admin-order-customer">Niran W.</span>
                            </div>
                            <div class="admin-order-details">
                                <span class="admin-order-amount">฿1,590</span>
                                <span class="admin-order-status delivered">Delivered</span>
                            </div>
                        </div>

                        <div class="admin-order-item">
                            <div class="admin-order-info">
                                <span class="admin-order-id">#ORD240727005</span>
                                <span class="admin-order-customer">Pranee M.</span>
                            </div>
                            <div class="admin-order-details">
                                <span class="admin-order-amount">฿890</span>
                                <span class="admin-order-status delivered">Delivered</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Low Stock Alerts -->
                <div class="admin-dashboard-card">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">Low Stock Alerts</h2>
                        <a href="/admin-products?filter=low-stock" class="admin-view-all">View All</a>
                    </div>
                    <div class="admin-stock-alerts">
                        <div class="admin-stock-item urgent">
                            <div class="admin-stock-info">
                                <span class="admin-stock-name">Amino-Acid Cleanser</span>
                                <span class="admin-stock-variant">150ml</span>
                            </div>
                            <div class="admin-stock-quantity critical">
                                3 left
                            </div>
                        </div>

                        <div class="admin-stock-item warning">
                            <div class="admin-stock-info">
                                <span class="admin-stock-name">Retinol Serum</span>
                                <span class="admin-stock-variant">30ml</span>
                            </div>
                            <div class="admin-stock-quantity low">
                                8 left
                            </div>
                        </div>

                        <div class="admin-stock-item warning">
                            <div class="admin-stock-info">
                                <span class="admin-stock-name">Hydrating Moisturiser</span>
                                <span class="admin-stock-variant">50ml</span>
                            </div>
                            <div class="admin-stock-quantity low">
                                12 left
                            </div>
                        </div>

                        <div class="admin-stock-item">
                            <div class="admin-stock-info">
                                <span class="admin-stock-name">Vitamin C Serum</span>
                                <span class="admin-stock-variant">30ml</span>
                            </div>
                            <div class="admin-stock-quantity low">
                                15 left
                            </div>
                        </div>

                        <div class="admin-stock-item">
                            <div class="admin-stock-info">
                                <span class="admin-stock-name">Travel Cleanser</span>
                                <span class="admin-stock-variant">50ml</span>
                            </div>
                            <div class="admin-stock-quantity low">
                                18 left
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Products -->
                <div class="admin-dashboard-card">
                    <h2 class="admin-card-title">Top Selling Products (This Week)</h2>
                    <div class="admin-top-products">
                        <div class="admin-product-rank">
                            <div class="admin-rank-number">1</div>
                            <div class="admin-product-info">
                                <span class="admin-product-name">Amino-Acid Cleanser</span>
                                <span class="admin-product-sales">89 sold</span>
                            </div>
                            <div class="admin-product-revenue">฿114,810</div>
                        </div>

                        <div class="admin-product-rank">
                            <div class="admin-rank-number">2</div>
                            <div class="admin-product-info">
                                <span class="admin-product-name">Hydrating Moisturiser</span>
                                <span class="admin-product-sales">67 sold</span>
                            </div>
                            <div class="admin-product-revenue">฿106,530</div>
                        </div>

                        <div class="admin-product-rank">
                            <div class="admin-rank-number">3</div>
                            <div class="admin-product-info">
                                <span class="admin-product-name">Vitamin C Serum</span>
                                <span class="admin-product-sales">52 sold</span>
                            </div>
                            <div class="admin-product-revenue">฿98,280</div>
                        </div>

                        <div class="admin-product-rank">
                            <div class="admin-rank-number">4</div>
                            <div class="admin-product-info">
                                <span class="admin-product-name">Complete Skincare Set</span>
                                <span class="admin-product-sales">24 sold</span>
                            </div>
                            <div class="admin-product-revenue">฿86,160</div>
                        </div>

                        <div class="admin-product-rank">
                            <div class="admin-rank-number">5</div>
                            <div class="admin-product-info">
                                <span class="admin-product-name">Retinol Serum</span>
                                <span class="admin-product-sales">31 sold</span>
                            </div>
                            <div class="admin-product-revenue">฿67,890</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <!-- Footer Main Content -->
            <div class="footer-main">
                <!-- Brand Section -->
                <div class="footer-brand">
                    <div class="footer-logo">
                        <h3 class="footer-logo-text">GAOJIE</h3>
                    </div>
                    <p class="footer-description">
                        Premium skincare crafted with clinically proven ingredients and scientific innovation for radiant, healthy skin.
                    </p>
                    <div class="footer-social">
                        <a href="#" class="social-link" aria-label="Instagram">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                        <a href="#" class="social-link" aria-label="TikTok">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                            </svg>
                        </a>
                        <a href="#" class="social-link" aria-label="Facebook">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                    </div>
                </div>

                <!-- Collections -->
                <div class="footer-column">
                    <h4 class="footer-column-title">Collections</h4>
                    <ul class="footer-links">
                        <li><a href="/cleanser" class="footer-link">Cleansers</a></li>
                        <li><a href="/moisturiser" class="footer-link">Moisturisers</a></li>
                        <li><a href="/treatments" class="footer-link">Treatments</a></li>
                        <li><a href="/lip-care" class="footer-link">Lip Care</a></li>
                        <li><a href="/sets" class="footer-link">Sets & Bundles</a></li>
                        <li><a href="/travel" class="footer-link">Travel Size</a></li>
                    </ul>
                </div>

                <!-- Company -->
                <div class="footer-column">
                    <h4 class="footer-column-title">Company</h4>
                    <ul class="footer-links">
                        <li><a href="/about" class="footer-link">About Us</a></li>
                        <li><a href="/science" class="footer-link">Our Science</a></li>
                        <li><a href="/ingredients" class="footer-link">Ingredients</a></li>
                        <li><a href="/sustainability" class="footer-link">Sustainability</a></li>
                        <li><a href="/reviews" class="footer-link">Reviews</a></li>
                        <li><a href="/blog" class="footer-link">Skincare Blog</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div class="footer-column">
                    <h4 class="footer-column-title">Support</h4>
                    <ul class="footer-links">
                        <li><a href="/contact" class="footer-link">Contact Us</a></li>
                        <li><a href="/faq" class="footer-link">FAQ</a></li>
                        <li><a href="/shipping" class="footer-link">Shipping Info</a></li>
                        <li><a href="/returns" class="footer-link">Returns</a></li>
                        <li><a href="/skincare-quiz" class="footer-link">Skincare Quiz</a></li>
                        <li><a href="/track-order" class="footer-link">Track Order</a></li>
                    </ul>
                </div>

                <!-- Newsletter -->
                <div class="footer-newsletter">
                    <span class="newsletter-incentive">Get 15% Off First Order</span>
                    <h4 class="footer-column-title">Join Our Skincare Community</h4>
                    <p class="newsletter-description">Be the first to know about new launches, exclusive offers, and expert skincare tips.</p>
                    
                    <ul class="newsletter-benefits">
                        <li>Exclusive early access to new products</li>
                        <li>Personalized skincare tips & routines</li>
                        <li>Members-only discounts & promotions</li>
                        <li>Free skincare consultation offers</li>
                    </ul>
                    
                    <div class="newsletter-form">
                        <input type="email" class="newsletter-input" placeholder="Enter your email for 15% off" aria-label="Email address">
                        <button type="submit" class="newsletter-button">Get My 15% Discount</button>
                    </div>
                    <p class="newsletter-disclaimer">
                        By subscribing, you agree to our <a href="/privacy" class="disclaimer-link">Privacy Policy</a>. Unsubscribe anytime.
                    </p>
                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="footer-bottom">
                <div class="footer-bottom-content">
                    <p class="footer-copyright">© 2025 GAOJIE. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="../gaojie-common.js"></script>
    <script>
        // Initialize admin dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Admin dashboard loaded');
            
            // Check if user is admin
            try {
                const response = await fetch('/api/auth/admin/check', { 
                    credentials: 'include' 
                });
                
                if (response.status === 403) {
                    // Not admin, redirect to main
                    if (window.GaojieUtils && GaojieUtils.showNotification) {
                        GaojieUtils.showNotification('Access denied. Admin privileges required.', 'error');
                    }
                    setTimeout(() => {
                        window.location.href = '/main';
                    }, 2000);
                    return;
                }
                
                const data = await response.json();
                
                if (data.status === 'success' && data.is_admin) {
                    console.log('Admin authenticated:', data.user);
                    
                    // Update admin name
                    const userNameEl = document.querySelector('#admin-user-menu .user-name');
                    if (userNameEl) {
                        userNameEl.textContent = `${data.user.first_name} (Admin)`;
                    }
                } else {
                    // Not authenticated or not admin
                    if (window.GaojieUtils && GaojieUtils.showNotification) {
                        GaojieUtils.showNotification('Please log in as admin to access this page.', 'error');
                    }
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 2000);
                }
            } catch (error) {
                console.error('Admin check failed:', error);
                if (window.GaojieUtils && GaojieUtils.showNotification) {
                    GaojieUtils.showNotification('Error checking admin status.', 'error');
                }
                setTimeout(() => {
                    window.location.href = '/main';
                }, 2000);
            }
            
            // Setup dropdown functionality
            const userBtn = document.querySelector('#admin-user-menu .user-btn');
            const dropdown = document.querySelector('#admin-user-menu .user-dropdown');
            
            if (userBtn && dropdown) {
                userBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#admin-user-menu')) {
                        dropdown.style.display = 'none';
                    }
                });
            }
        });

        // Handle logout function
        window.handleLogout = async function() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (window.GaojieUtils && GaojieUtils.showNotification) {
                    GaojieUtils.showNotification('Logged out successfully', 'success');
                }
                
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 1000);
                
            } catch (error) {
                console.error('Logout failed:', error);
                if (window.GaojieUtils && GaojieUtils.showNotification) {
                    GaojieUtils.showNotification('Logout failed', 'error');
                }
            }
        };
    </script>
    <script src="script.js"></script>
    <script src="../JS/admin-script.js"></script>
</body>
</html>